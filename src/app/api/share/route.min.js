import{kv}from"@vercel/kv";import{nanoid}from"nanoid";const corsHeaders={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET,POST,OPTIONS","Access-Control-Allow-Headers":"Content-Type"};export async function OPTIONS(){return new Response(null,{status:204,headers:corsHeaders})}export async function POST(req){try{const body=await req.json(),tabs=body?.tabs;if(!Array.isArray(tabs)||0===tabs.length)return new Response("Invalid tabs",{status:400,headers:corsHeaders});const id=nanoid(8);return await kv.set(`tabs:${id}`,JSON.stringify(tabs),{ex:604800}),new Response(JSON.stringify({id:id}),{status:200,headers:{"Content-Type":"application/json",...corsHeaders}})}catch(err){return console.error("POST /api/share error:",err),new Response("Server error",{status:500,headers:corsHeaders})}}export async function GET(req){try{const{searchParams:searchParams}=new URL(req.url),id=searchParams.get("id");if(!id)return new Response("Missing id",{status:400,headers:corsHeaders});const stored=await kv.get(`tabs:${id}`);if(!stored)return new Response("Not found",{status:404,headers:corsHeaders});const tabs=JSON.parse(stored);return new Response(JSON.stringify({id:id,tabs:tabs}),{status:200,headers:{"Content-Type":"application/json",...corsHeaders}})}catch(err){return console.error("GET /api/share error:",err),new Response("Server error",{status:500,headers:corsHeaders})}}